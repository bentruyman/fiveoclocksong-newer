/*!
 * Weld - A Widget Framework v0.11.0
 */(function(a,b){var c={},d=function(b){return b===a?"global":{}.toString.call(b).match(/\s([a-z|A-Z]+)/)[1].toLowerCase()};(function(a,c){"use strict",a.App=function(c){function l(){c.paths&&(g.middlewares=c.paths.middlewares||g.middlewares,g.widgets=c.paths.widgets||g.widgets)}function m(a){return i[a]||null}function n(a,b,c){var d=[];for(var e=0,f=b.length;e<f;e++)d.push(g[a]+"/"+b[e]);require(d,function(){var a=[];a.push.apply(a,arguments),c(a)})}function o(a){return{options:a.options||{},handler:a.handler}}function p(a,b){q(a,function(c){b(c[a])})}function q(a,b){n("middlewares",a,function(c){var d={};for(var e=0,f=a.length;e<f;e++)d[a[e]]=o(c[e]);b(d)})}function r(a){if(a===null)throw new Error("The widget was not defined properly");return{options:a.options||{},middlewares:a.middlewares,creator:a.creator}}function s(a,c){n("widgets",[a],function(d){var e=d[0];if(e===b)throw new j(a);c(r(e))})}function t(a,c){if(a!==b&&c!==b){var d=a.concat(c);for(var e=0;e<d.length;e++)for(var f=e+1;f<d.length;f++)d[e]===d[f]&&d.splice(f,1);return d}return a||c}c=c||{};var d=a.App,e=new a.Messenger,f=0,g={middlewares:"middlewares",widgets:"widgets"},h=c.prefix||"weld-module-",i={},j=d.WidgetNotFoundError,k=d.RequiredCreatorMethodError;return e.create=function(a,b){var c=h+f++;return i[c]={type:a,instance:null,options:b},c},e.start=function(c){var d=m(c),f={},g,h,i;return d!==null&&d.instance===null?(s(d.type,function(j){var l=j.creator,m=j.middlewares;q(m||[],function(l){f.app=e,f.options=d.options,i=new a.Sandbox(c,f),g=function(){d.instance=j.creator(i);if(d.instance.create===b)throw new k("create");d.instance.create()};if(m){var n=0,o=m.length;h=function(){n+1>o?g():l[m[n++]].handler.call(null,i,h)},h()}else g()})}),c):null},e.stop=function(a){var c=m(a);if(c!==null&&c.instance!==null){if(c.instance.destroy===b)throw new k("destroy");return c.instance.destroy(),c.instance=null,a}return null},l(),e},a.App.WidgetNotFoundError=function(a){this.name="WidgetNotFoundError",this.message="Widget "+(a?""+a+" ":"")+"doesn't exist"},a.App.RequiredCreatorMethodError=function(){this.name="RequiredCreatorMethodError",this.message='Widgets creator functions are required to return both a "create" and "destroy" function.'},a.App.WidgetNotFoundError.prototype=new Error,a.App.RequiredCreatorMethodError.prototype=new Error})(c,requirejs),function(a){a.Messenger=function(){var a=this,c={},d,e,f,g,h,i;a.publish=function(a,d,e){var f,g;if(c[a]){thisMessage=d!==b?d:[],g=c[a];for(var h=0,i=g.length;h<i;h++)g[h].call(e||null,thisMessage)}},a.publishMany=function(b,c,d){for(var e=0,f=b.length;e<f;e++)a.publish(b[e],c,d)},a.subscribe=function(a,d){return c[a]===b&&(c[a]=[]),c[a].push(d),{channel:a,callback:d}},a.subscribeMany=function(b,c){var d=[];for(var e=0,f=b.length;e<f;e++)d.push(a.subscribe(b[e],c));return d},a.unsubscribe=function(a){var b=a.channel;if(b&&c[b]){var d=c[b];for(var e=0,f=d.length;e<f;e++)d[e]===a.callback&&d.splice(e,1)}},a.unsubscribeMany=function(b){for(var c=0,d=b.length;c<d;c++)a.unsubscribe(b[c])}},a.Messenger.Scoped=function(b,c){var d=a.Messenger,e=this,f=[],g,h,i,j;c||(c=new d),e.publish=function(a,d,e){c.publish(b+a,d,e)},e.subscribe=function(a,d){var e=c.subscribe(b+a,d);return f.push(e),e},e.unsubscribe=function(a){c.unsubscribe(a)},e.unsubscribeAll=function(){c.unsubscribeMany(f)}}}(c),function(a){a.Sandbox=function(b,c){c=c||{};var d=new a.Messenger.Scoped("/"+b,c.app||null),e=c.options||{};return d.app=c.app,d.getId=function(){return b},d.getOption=function(a){return e[a]},d}}(c),a.Weld=c})(this);